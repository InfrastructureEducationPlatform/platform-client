openapi: 3.0.1
info:
  title: BlockInfrastructure-Core
  version: '1.0'
paths:
  /auth/login:
    post:
      tags:
        - Auth
      summary: 서비스에 로그인을 실시합니다.
      description: 등록되지 않은 유저인 경우 NeedsRegistration과 JoinToken을 응답으로 반환합니다.
      operationId: LoginAsync
      requestBody:
        description: ''
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
          text/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
          application/*+json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
      responses:
        '200':
          description: "OAuth에서 정보를 성공적으로 가져온 경우. 등록되지 않은 사용자는 LoginResult가 NeedsRegistration로 표기되고, 등록된 사용자는 로그인 성공으로 판단해\r\nLoginSucceed를 반환합니다."
          content:
            text/plain:
              schema:
                $ref: '#/components/schemas/TokenResponse'
            application/json:
              schema:
                $ref: '#/components/schemas/TokenResponse'
            text/json:
              schema:
                $ref: '#/components/schemas/TokenResponse'
        '400':
          description: OAuth 로그인 혹은 OAuth 정보를 가져오는데 실패한 경우.
          content:
            text/plain:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
            text/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /auth/register:
    post:
      tags:
        - Auth
      summary: 서비스에 회원 가입합니다.
      operationId: RegisterAsync
      requestBody:
        description: ''
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SignUpRequest'
          text/json:
            schema:
              $ref: '#/components/schemas/SignUpRequest'
          application/*+json:
            schema:
              $ref: '#/components/schemas/SignUpRequest'
      responses:
        '200':
          description: 회원 가입에 성공했을 때 반환합니다.
          content:
            text/plain:
              schema:
                $ref: '#/components/schemas/TokenResponse'
            application/json:
              schema:
                $ref: '#/components/schemas/TokenResponse'
            text/json:
              schema:
                $ref: '#/components/schemas/TokenResponse'
        '400':
          description: JWT Join Token Validation에 실패했을 때
          content:
            text/plain:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
            text/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '409':
          description: 이미 존재하는 인증 정보일 때
          content:
            text/plain:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
            text/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /auth/refresh:
    post:
      tags:
        - Auth
      summary: 리프레시 로직을 실행합니다.
      operationId: RefreshAsync
      requestBody:
        description: 리프레시 요청
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RefreshTokenRequest'
          text/json:
            schema:
              $ref: '#/components/schemas/RefreshTokenRequest'
          application/*+json:
            schema:
              $ref: '#/components/schemas/RefreshTokenRequest'
      responses:
        '200':
          description: 리프레시에 성공했을 때 반환합니다.
          content:
            text/plain:
              schema:
                $ref: '#/components/schemas/TokenResponse'
            application/json:
              schema:
                $ref: '#/components/schemas/TokenResponse'
            text/json:
              schema:
                $ref: '#/components/schemas/TokenResponse'
        '401':
          description: '엑세스 토큰이 잘못되었거나, 리프레시 로직에 실패했을 때'
          content:
            text/plain:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
            text/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /channels:
    post:
      tags:
        - Channel
      summary: '채널을 생성하고, 생성한 사람을 Owner로 추가합니다.'
      operationId: CreateChannelAsync
      requestBody:
        description: 채널 생성 요청
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateChannelRequest'
          text/json:
            schema:
              $ref: '#/components/schemas/CreateChannelRequest'
          application/*+json:
            schema:
              $ref: '#/components/schemas/CreateChannelRequest'
      responses:
        '200':
          description: Success
        '204':
          description: 채널 생성에 성공한 경우
      security:
        - JwtAuthenticationFilter: []
  '/channels/{channelId}/sketches':
    get:
      tags:
        - Sketch
      summary: '채널 내에 있는 모든 스케치를 가져옵니다,'
      description: '이 API는 채널의 Owner, Reader 모두 조회할 수 있습니다.'
      operationId: ListSketchesInChannelAsync
      parameters:
        - name: channelId
          in: path
          description: 조회할 채널 ID
          required: true
          style: simple
          schema:
            type: string
      responses:
        '200':
          description: 조회에 성공한 경우.
          content:
            text/plain:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/SketchResponse'
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/SketchResponse'
            text/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/SketchResponse'
        '401':
          description: 인증 토큰이 없어 인증에 실패한 경우
          content:
            text/plain:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
            text/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: 스케치를 가져오는데 채널 권한이 부족한 경우(해당 API에서는 소속되어 있지 않은 채널을 조회하려 했을 때 반환)
          content:
            text/plain:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
            text/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
      security:
        - JwtAuthenticationFilter: []
  /users/me:
    get:
      tags:
        - Users
      summary: '사용자의 현재 정보와, 소속되어 있는 채널 정보를 반환합니다.'
      operationId: GetUsersDetailProjectionAsync
      responses:
        '200':
          description: 사용자 조회에 성공한 경우
          content:
            text/plain:
              schema:
                $ref: '#/components/schemas/MeResponse'
            application/json:
              schema:
                $ref: '#/components/schemas/MeResponse'
            text/json:
              schema:
                $ref: '#/components/schemas/MeResponse'
        '404':
          description: 사용자를 어떠한 이유로 찾을 수 없는 경우
          content:
            text/plain:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
            text/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
      security:
        - JwtAuthenticationFilter: []
components:
  schemas:
    ChannelPermissionProjection:
      required:
        - channelId
        - channelName
        - channelPermissionType
        - createdAt
        - userId
      type: object
      properties:
        userId:
          minLength: 1
          type: string
          description: 사용자 ID
        channelId:
          minLength: 1
          type: string
          description: 사용자가 소속되어 있는 Channel ID
        channelName:
          minLength: 1
          type: string
          description: 채널 이름
        channelPermissionType:
          $ref: '#/components/schemas/ChannelPermissionType'
        createdAt:
          type: string
          description: 권한이 추가된 시작
          format: date-time
      additionalProperties: false
    ChannelPermissionType:
      enum:
        - Owner
        - Reader
      type: string
    CreateChannelRequest:
      required:
        - description
        - name
      type: object
      properties:
        name:
          minLength: 1
          type: string
          description: 생성할 채널의 이름입니다.
        description:
          minLength: 1
          type: string
          description: 생성할 채널의 1줄 설명입니다.
        imageUrl:
          type: string
          description: 'Optional: 채널의 프로필 이미지 URL입니다.'
          nullable: true
      additionalProperties: false
    CredentialProvider:
      enum:
        - Google
        - Self
      type: string
    ErrorResponse:
      type: object
      properties:
        statusCodes:
          type: integer
          format: int32
        errorMessage:
          type: string
          nullable: true
        errorTitle:
          type: string
          nullable: true
      additionalProperties: false
    LoginRequest:
      required:
        - authenticationCode
        - provider
      type: object
      properties:
        provider:
          $ref: '#/components/schemas/CredentialProvider'
        authenticationCode:
          minLength: 1
          type: string
          description: OAuth Provider이 보내주는 인가 코드입니다.
      additionalProperties: false
    LoginResult:
      enum:
        - NeedsRegistration
        - LoginSucceed
      type: string
    MeResponse:
      required:
        - channelPermissionList
        - email
        - name
        - userId
      type: object
      properties:
        userId:
          minLength: 1
          type: string
          description: 사용자 Unique ID
        name:
          minLength: 1
          type: string
          description: 사용자 이름(닉네임)
        email:
          minLength: 1
          type: string
          description: 사용자 이메일
        profilePictureImageUrl:
          type: string
          description: 'Optional, 사용자 프로필 이미지'
          nullable: true
        channelPermissionList:
          type: array
          items:
            $ref: '#/components/schemas/ChannelPermissionProjection'
          description: 사용자가 속한 채널의 권한 리스트
      additionalProperties: false
    RefreshTokenRequest:
      required:
        - accessToken
        - refreshToken
      type: object
      properties:
        accessToken:
          minLength: 1
          type: string
          description: 만료된 엑세스 토큰
        refreshToken:
          minLength: 1
          type: string
          description: 리프레시 토큰
      additionalProperties: false
    SignUpRequest:
      type: object
      properties:
        name:
          type: string
          description: User Nickname
          nullable: true
        email:
          type: string
          description: User Email
          nullable: true
        profileImageUrl:
          type: string
          description: Profile Image URL(Can be NULL)
          nullable: true
        joinToken:
          type: string
          description: 로그인 API에서 받은 Join Token입니다.
          nullable: true
        credentialProvider:
          $ref: '#/components/schemas/CredentialProvider'
      additionalProperties: false
    SketchResponse:
      required:
        - blockSketch
        - channelId
        - description
        - name
        - sketchId
      type: object
      properties:
        sketchId:
          minLength: 1
          type: string
          description: 스케치의 Unique ID입니다.
        name:
          minLength: 1
          type: string
          description: 스케치의 이름입니다.
        description:
          minLength: 1
          type: string
          description: 스케치의 설명입니다.
        channelId:
          minLength: 1
          type: string
          description: 스케치의 채널 ID입니다.
        blockSketch:
          description: 스케치의 블록 스케치입니다.
      additionalProperties: false
    TokenResponse:
      required:
        - loginResult
        - token
      type: object
      properties:
        loginResult:
          $ref: '#/components/schemas/LoginResult'
        token:
          minLength: 1
          type: string
          description: 'Access Token, expires in an hour.'
        refreshToken:
          type: string
          description: 'Refresh Token, expires in 30 days.'
          nullable: true
      additionalProperties: false
  securitySchemes:
    JwtAuthenticationFilter:
      type: http
      scheme: Bearer
